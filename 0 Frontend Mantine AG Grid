import React, { Component } from 'react';
import { Autocomplete } from '@mantine/core';

class MantineAutocompleteCellEditor extends Component {
  constructor(props) {
    super(props);
    this.state = {
      value: props.value || '',
      options: props.values || [],
    };
    this.inputRef = React.createRef();

    this.handleChange = this.handleChange.bind(this);
    this.handleKeyDown = this.handleKeyDown.bind(this);
    this.handleItemSubmit = this.handleItemSubmit.bind(this);
  }

  componentDidMount() {
    if (this.inputRef.current) {
      this.inputRef.current.focus();
    }
  }

  getValue() {
    console.log('getValue called, returning:', this.state.value);
    return this.state.value;
  }

  handleChange(newValue) {
    this.setState({ value: newValue });
  }

  handleKeyDown(event) {
    if (event.key === 'Enter') {
      event.preventDefault();
      this.props.stopEditing();
    }
  }

  handleItemSubmit(item) {
    const newValue = item.value || item;
    this.setState({ value: newValue }, () => {
      this.props.stopEditing();
    });
  }

  render() {
    return (
      <Autocomplete
        ref={this.inputRef}
        value={this.state.value}
        data={this.state.options}
        onChange={this.handleChange}
        onItemSubmit={this.handleItemSubmit}
        placeholder="Type or select"
        nothingFound="No options"
        styles={{ input: { width: '100%' } }}
        onKeyDown={this.handleKeyDown}
      />
    );
  }
}

export default MantineAutocompleteCellEditor;
