import { ICellEditorComp, ICellEditorParams } from '@ag-grid-community/core';
import React from 'react';
import { Autocomplete } from '@mantine/core';

export class MantineAutocompleteEditor implements ICellEditorComp {
  private gui!: HTMLDivElement; // Container for Mantine Autocomplete
  private params!: ICellEditorParams;
  private value!: string;

  // Initialization method
  init(params: ICellEditorParams) {
    this.params = params;
    this.value = params.value || '';  // Initialize with the current value

    // Create a div element to hold the Autocomplete component
    this.gui = document.createElement('div');
    this.gui.classList.add('mantine-autocomplete-editor');

    // Render Mantine Autocomplete inside the container
    React.render(
      <Autocomplete
        data={params.options || []}  // Options passed from params
        value={this.value}
        onChange={(val: string) => this.value = val}  // Update value on change
        placeholder="Type or select"
        nothingFound="No options"
        styles={{ input: { width: '100%' } }}  // Full width styling
      />,
      this.gui
    );
  }

  // Return the GUI element (the div holding the Autocomplete component)
  getGui(): HTMLElement {
    return this.gui;
  }

  // Return the final value
  getValue(): any {
    return this.value;
  }

  // Focus on the input when the component is attached to the DOM
  afterGuiAttached() {
    const inputElement = this.gui.querySelector('input');
    if (inputElement) {
      inputElement.focus();
    }
  }
}
