from fastapi import FastAPI, File, UploadFile
import base64
import mimetypes

app = FastAPI()

@app.post("/upload-file/")
async def upload_file(file: UploadFile = File(...)):
    """Accepts an uploaded file, encodes it to base64, and returns the encoded content and MIME type."""
    # Get the file's content (as binary)
    file_content = await file.read()

    # Detect the file's MIME type based on its file extension
    mime_type, _ = mimetypes.guess_type(file.filename)

    # If MIME type cannot be detected, default to 'application/octet-stream'
    if mime_type is None:
        mime_type = 'application/octet-stream'
    
    # Encode the file content to base64
    encoded_content = base64.b64encode(file_content).decode('utf-8')
    
    # Return the base64 encoded content and MIME type
    return {
        'encoded_content': encoded_content,
        'mime_type': mime_type
    }
